{% extends "home.html" %}

{% block navbar %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/">NotesShare</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/#features">Features</a></li>
        <li class="nav-item"><a class="btn btn-outline-light ms-2" href="/login/">Login</a></li>
        <li class="nav-item"><a class="btn btn-outline-light ms-2" href="#">Register</a></li>
      </ul>
    </div>
  </div>
</nav>
{% endblock %}

{% block hero %}{% endblock %}
{% block info %}{% endblock %}
{% block review %}{% endblock %}

{% block main %}
<section class="py-5" style="min-height: 90vh; background-color: #f8f9fa;">
  <div class="container">
    <h2 class="text-center mb-4 fw-bold">Create Your Account</h2>
    <div class="row justify-content-center">
      <div class="col-md-7 col-lg-6">
        <div class="card shadow border-0">
          <div class="card-body p-4">

            <!-- Django Messages -->
            {% if messages %}
              {% for message in messages %}
              <div class="alert alert-info alert-dismissible fade show" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
              {% endfor %}
            {% endif %}

            <!-- Registration Form -->
            <form method="post" onsubmit="return validateForm()" id="registerForm">
              {% csrf_token %}

              <div class="mb-3">
                <label for="username" class="form-label">Username</label>
                <input type="text" name="username" id="username" class="form-control" placeholder="Enter a username" onkeyup="validateUsername()">
                <small class="text-danger" id="usernameError"></small>
              </div>

              <div class="mb-3">
                <label for="email" class="form-label">Email Address</label>
                <input type="email" name="email" id="email" class="form-control" placeholder="Enter your email" onkeyup="validateEmail()">
                <small class="text-danger" id="emailError"></small>
              </div>

              <div class="mb-3">
                <label for="mobile" class="form-label">Mobile Number</label>
                <input type="text" name="mobile" id="mobile" class="form-control" placeholder="Enter your mobile number" onkeyup="validateMobile()">
                <small class="text-danger" id="mobileError"></small>
              </div>

              <div class="mb-3">
                <label class="form-label d-block">Gender</label>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="genderMale" value="male">
                  <label class="form-check-label" for="genderMale">Male</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="genderFemale" value="female">
                  <label class="form-check-label" for="genderFemale">Female</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="gender" id="genderOther" value="other">
                  <label class="form-check-label" for="genderOther">Other</label>
                </div>
                <br>
                <small class="text-danger" id="genderError"></small>
              </div>

              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input type="password" name="password" id="password" class="form-control" placeholder="Create a password" onkeyup="validatePassword()">
                <small class="text-danger" id="passwordError"></small>
              </div>

              <div class="mb-3">
                <label for="confirmPassword" class="form-label">Confirm Password</label>
                <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm your password" onkeyup="validateConfirmPassword()">
                <small class="text-danger" id="confirmPasswordError"></small>
              </div>

              <button type="submit" class="btn btn-primary w-100">Register</button>
            </form>

            <div class="mt-3 text-center">
              <p>Already have an account? <a href="/login/">Login here</a></p>
            </div>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Client-side Form Validation Script -->
<script>
  function validateUsername() {
    const username = document.getElementById("username").value.trim();
    document.getElementById("usernameError").innerText = username.length < 3 ? "Username must be at least 3 characters." : "";
  }

function validateEmail() {
  const email = document.getElementById("email").value.trim();
  const emailError = document.getElementById("emailError");
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  
  if (!emailRegex.test(email)) {
    emailError.innerText = "Please enter a valid email.";
  } else {
    emailError.innerText = "";  // ✅ This removes the red message
  }
}

function validateMobile() {
  const mobile = document.getElementById("mobile").value.trim();
  const mobileError = document.getElementById("mobileError");
  const mobileRegex = /^[6-9]\d{9}$/;  // ✅ Starts from 6-9 and is 10 digits
  
  if (!mobileRegex.test(mobile)) {
    mobileError.innerText = "Enter a valid 10-digit mobile number starting with 6-9.";
  } else {
    mobileError.innerText = "";  // ✅ This removes the red message
  }
}


  function validateGender() {
    const gender = document.querySelector('input[name="gender"]:checked');
    document.getElementById("genderError").innerText = !gender ? "Please select your gender." : "";
  }

  function validatePassword() {
    const password = document.getElementById("password").value;
    document.getElementById("passwordError").innerText = password.length < 6 ? "Password must be at least 6 characters." : "";
  }

  function validateConfirmPassword() {
    const password = document.getElementById("password").value;
    const confirm = document.getElementById("confirmPassword").value;
    document.getElementById("confirmPasswordError").innerText = password !== confirm ? "Passwords do not match." : "";
  }

  function validateForm() {
    validateUsername();
    validateEmail();
    validateMobile();
    validateGender();
    validatePassword();
    validateConfirmPassword();

    const errors = document.querySelectorAll(".text-danger");
    for (let e of errors) {
      if (e.innerText !== "") return false;
    }
    return true;
  }
</script>
{% endblock %}
