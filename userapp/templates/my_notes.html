{% extends "userhome.html" %} {% block main1 %}
<div class="row g-3">
  <div class="col-md-3">
    <div class="card-box2 text-center">
      <h4>MY NOTES</h4>
      <h3 id="note-counter">0</h3>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card-box2 text-center">
      <h4>MY FAVORITES</h4> 
      <h3 id="favorite_counter">0</h3>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card-box2 text-center">
      <h4>VIEWS</h4>
      <h3 id="view-counter">0</h3>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card-box2 text-center">
      <h4>DOWNLOADS</h4>
      <h3 id="download-counter">0</h3>
    </div>
  </div>
</div>

<!-- Count-up animation script -->
<script>
    const target = {{ obj|length }};
    const counter = document.getElementById("note-counter");
    let count = 0;
   if (target>0){
    const interval = setInterval(() => {
      count++;
      counter.textContent = count;

      if (count === target) {
        clearInterval(interval); // Stop when target is reached
      }
    }, 100); // speed (50ms = fast, 100ms = slower)
   }

  //  Favorites Counter
    const target2= {{ favorite }}; // Updated variable name
    const counter2 = document.getElementById("favorite_counter");
    let count2 = 0;
   if (target2>0){
    const interval2 = setInterval(() => {
      count2++;
      counter2.textContent = count2;

      if (count2 === target2) {
        clearInterval(interval2); // Stop when target is reached
      }
    }, 100); // speed (50ms = fast, 100ms = slower)
   }

  //Views Counter
    const target3= {{ total_view }};
    const counter3 = document.getElementById("view-counter");
    let count3 = 0;
   if (target3>0){
    const interval3 = setInterval(() => {
      count3++;
      counter3.textContent = count3;

      if (count3 === target3) {
        clearInterval(interval3); // Stop when target is reached
      }
    }, 100); // speed (50ms = fast, 100ms = slower)
   }


  //Downloads Counter
    const target4= {{ total_downloads }};
    const counter4 = document.getElementById("download-counter");
    let count4 = 0;
   if (target4>0){
    const interval4 = setInterval(() => {
      count4++;
      counter4.textContent = count4;

      if (count4 === target4) {
        clearInterval(interval4); // Stop when target is reached
      }
    }, 100); // speed (50ms = fast, 100ms = slower)
   }
</script>
{% endblock %}


{% block notestable %}
<!-- Recent Notes Table -->
<div class="row mt-4">
  <div class="col-12">
    <h5>Recent Notes</h5>
    <div class="card-box">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>#</th>
            <th>User Name</th>
            <th>Title</th>
            <th>Category</th>
            <th>Date Modified</th>
            <th>Size</th>
            <th>Visibility</th>
            <th>View</th>
            <th>Delete</th>
            <th>Download</th>
            <th>Share</th>
          </tr>
        </thead>
        <tbody>
          {% for i in obj %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ i.username }}</td>
            <td>📄 {{ i.title }}</td>
            <td>{{ i.category }}</td>
            <td>{{ i.upload_at }}</td>
            <td>{{ i.file_size }}</td>
            <td>👁️ {{ i.visibility }}</td>
            <td>
              <a href="/userhome/view_pdf/?id={{ i.id }}"
                ><button
                  style="
                    background-color: rgb(233, 221, 219);
                    border-radius: 5px;
                    font-weight: bold;
                  "
                >
                  View
                </button></a
              >
            </td>
            <td>
              <a href="/userhome/delete_pdf/?id={{ i.id }}"
                ><button
                  style="
                    background-color: #f09783;
                    border-radius: 5px;
                    font-weight: bold;
                  "
                  value="Delete"
                  onclick="return confirm('Are you sure you want to delete this?')"
                >
                  Delete
                </button></a
              >
            </td>
            <td>
              <a
                href="/userhome/download_pdf/?name={{ i.id }}"
                style="text-decoration: none"
                >Download</a
              >
            </td>
            <td>
              <div style="position: relative; display: inline-block">
                <button
                  onclick="toggleShareMenu('{{ i.id }}')"
                  style="background: none; border: none"
                >
                  🔗
                </button>

                <div
                  id="share-menu-{{ i.id }}"
                  class="share-menu"
                  style="
                    display: none;
                    position: absolute;
                    background: white;
                    border: 1px solid #ccc;
                    margin-left: -30px;
                    padding: 8px;
                    border-radius: 5px;
                    z-index: 100;
                  "
                >
                  <a
                    href="https://api.whatsapp.com/send?text={{ request.build_absolute_uri }}/view_pdf/?id={{ i.id }}"
                    target="_blank"
                    >📱 WhatsApp</a
                  ><br />
                  <a
                    href="mailto:?subject=Check this note&body={{ request.build_absolute_uri }}/view_pdf/?id={{ i.id }}"
                    target="_blank"
                    >✉️ Email</a
                  ><br />
                  <a
                    href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}/view_pdf/?id={{ i.id }}"
                    target="_blank"
                    >📘 Facebook</a
                  ><br />
                  <a href="https://www.instagram.com/" target="_blank"
                    >📸 Instagram</a
                  >
                </div>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <!-- <div class="text-end">
                <a href="#" class="btn btn-link">View All</a>
              </div> -->
    </div>
  </div>
</div>
<script>
  // JavaScript to handle button click and open PDF
  document.addEventListener("DOMContentLoaded", function () {
    const buttons = document.querySelectorAll(".view-btn");

    buttons.forEach((button) => {
      button.addEventListener("click", function () {
        const pdfUrl = this.getAttribute("data-url");
        window.open(pdfUrl, "_blank"); // Opens in new tab
      });
    });
  });
</script>
{% endblock %}
